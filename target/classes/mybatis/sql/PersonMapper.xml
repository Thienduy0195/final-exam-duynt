<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="exam.mappers.PersonMapper">
  <resultMap id="BaseResultMap" type="exam.entities.Person">

    <id column="CCCD" jdbcType="VARCHAR" property="cccd" />
    <result column="ho_ten" jdbcType="NVARCHAR" property="hoTen" />
    <result column="ngay_sinh" jdbcType="VARCHAR" property="ngaySinh" />
    <result column="gioi_tinh" jdbcType="VARCHAR" property="gioiTinh" />
    <result column="so_dien_thoai" jdbcType="VARCHAR" property="soDienThoai" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="so_the_BHYT" jdbcType="VARCHAR" property="soTheBhyt" />
    <result column="nghe_nghiep" jdbcType="NVARCHAR" property="ngheNghiep" />
    <result column="dia_chi" jdbcType="NVARCHAR" property="diaChi" />
    <result column="ngay_dang_ky" jdbcType="NVARCHAR" property="ngayDangKy" />
    <result column="trang_thai_tiem" jdbcType="INTEGER" property="trangThaiTiem" />
  </resultMap>

  <resultMap id="subDTO" type="exam.dto.SubDTO">
    <id column="CCCD" jdbcType="VARCHAR" property="cccd" />
    <result column="ho_ten" jdbcType="NVARCHAR" property="hoTen" />
    <result column="ngay_sinh" jdbcType="VARCHAR" property="ngaySinh" />
    <result column="gioi_tinh" jdbcType="VARCHAR" property="gioiTinh" />
    <result column="so_dien_thoai" jdbcType="VARCHAR" property="soDienThoai" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="so_the_BHYT" jdbcType="VARCHAR" property="soTheBhyt" />
    <result column="nghe_nghiep" jdbcType="NVARCHAR" property="ngheNghiep" />
    <result column="dia_chi" jdbcType="NVARCHAR" property="diaChi" />
    <result column="ngay_dang_ky" jdbcType="NVARCHAR" property="ngayDangKy" />
    <result column="trang_thai_tiem" jdbcType="INTEGER" property="trangThaiTiem" />
    <result column="so_lan_tiem" jdbcType="INTEGER" property="soLanTiem" />
    <result column="ngay_tiem_gan_nhat" jdbcType="VARCHAR" property="ngayTiemGanNhat" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    CCCD, ho_ten, ngay_sinh, gioi_tinh, so_dien_thoai, email, so_the_BHYT, nghe_nghiep, 
    dia_chi, ngay_dang_ky, trang_thai_tiem
  </sql>
  <select id="selectByExample" parameterType="exam.entities.PersonExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from Person
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    select 
    <include refid="Base_Column_List" />
    from Person
    where CCCD = #{cccd,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    delete from Person
    where CCCD = #{cccd,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="exam.entities.PersonExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    delete from Person
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="exam.entities.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    insert into Person (CCCD, ho_ten, ngay_sinh, 
      gioi_tinh, so_dien_thoai, email, 
      so_the_BHYT, nghe_nghiep, dia_chi, 
      ngay_dang_ky, trang_thai_tiem)
    values (#{cccd,jdbcType=VARCHAR}, #{hoTen,jdbcType=NVARCHAR}, #{ngaySinh,jdbcType=VARCHAR}, 
      #{gioiTinh,jdbcType=VARCHAR}, #{soDienThoai,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, 
      #{soTheBhyt,jdbcType=VARCHAR}, #{ngheNghiep,jdbcType=NVARCHAR}, #{diaChi,jdbcType=NVARCHAR}, 
      #{ngayDangKy,jdbcType=NVARCHAR}, #{trangThaiTiem,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="exam.entities.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    insert into Person
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="cccd != null">
        CCCD,
      </if>
      <if test="hoTen != null">
        ho_ten,
      </if>
      <if test="ngaySinh != null">
        ngay_sinh,
      </if>
      <if test="gioiTinh != null">
        gioi_tinh,
      </if>
      <if test="soDienThoai != null">
        so_dien_thoai,
      </if>
      <if test="email != null">
        email,
      </if>
      <if test="soTheBhyt != null">
        so_the_BHYT,
      </if>
      <if test="ngheNghiep != null">
        nghe_nghiep,
      </if>
      <if test="diaChi != null">
        dia_chi,
      </if>
      <if test="ngayDangKy != null">
        ngay_dang_ky,
      </if>
      <if test="trangThaiTiem != null">
        trang_thai_tiem,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="cccd != null">
        #{cccd,jdbcType=VARCHAR},
      </if>
      <if test="hoTen != null">
        #{hoTen,jdbcType=NVARCHAR},
      </if>
      <if test="ngaySinh != null">
        #{ngaySinh,jdbcType=VARCHAR},
      </if>
      <if test="gioiTinh != null">
        #{gioiTinh,jdbcType=VARCHAR},
      </if>
      <if test="soDienThoai != null">
        #{soDienThoai,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="soTheBhyt != null">
        #{soTheBhyt,jdbcType=VARCHAR},
      </if>
      <if test="ngheNghiep != null">
        #{ngheNghiep,jdbcType=NVARCHAR},
      </if>
      <if test="diaChi != null">
        #{diaChi,jdbcType=NVARCHAR},
      </if>
      <if test="ngayDangKy != null">
        #{ngayDangKy,jdbcType=NVARCHAR},
      </if>
      <if test="trangThaiTiem != null">
        #{trangThaiTiem,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="exam.entities.PersonExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    select count(*) from Person
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>

  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    update Person
    <set>
      <if test="row.cccd != null">
        CCCD = #{row.cccd,jdbcType=VARCHAR},
      </if>
      <if test="row.hoTen != null">
        ho_ten = #{row.hoTen,jdbcType=NVARCHAR},
      </if>
      <if test="row.ngaySinh != null">
        ngay_sinh = #{row.ngaySinh,jdbcType=VARCHAR},
      </if>
      <if test="row.gioiTinh != null">
        gioi_tinh = #{row.gioiTinh,jdbcType=VARCHAR},
      </if>
      <if test="row.soDienThoai != null">
        so_dien_thoai = #{row.soDienThoai,jdbcType=VARCHAR},
      </if>
      <if test="row.email != null">
        email = #{row.email,jdbcType=VARCHAR},
      </if>
      <if test="row.soTheBhyt != null">
        so_the_BHYT = #{row.soTheBhyt,jdbcType=VARCHAR},
      </if>
      <if test="row.ngheNghiep != null">
        nghe_nghiep = #{row.ngheNghiep,jdbcType=NVARCHAR},
      </if>
      <if test="row.diaChi != null">
        dia_chi = #{row.diaChi,jdbcType=NVARCHAR},
      </if>
      <if test="row.ngayDangKy != null">
        ngay_dang_ky = #{row.ngayDangKy,jdbcType=NVARCHAR},
      </if>
      <if test="row.trangThaiTiem != null">
        trang_thai_tiem = #{row.trangThaiTiem,jdbcType=INTEGER},
      </if>
    </set>
    <if test="example != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    update Person
    set CCCD = #{row.cccd,jdbcType=VARCHAR},
      ho_ten = #{row.hoTen,jdbcType=NVARCHAR},
      ngay_sinh = #{row.ngaySinh,jdbcType=VARCHAR},
      gioi_tinh = #{row.gioiTinh,jdbcType=VARCHAR},
      so_dien_thoai = #{row.soDienThoai,jdbcType=VARCHAR},
      email = #{row.email,jdbcType=VARCHAR},
      so_the_BHYT = #{row.soTheBhyt,jdbcType=VARCHAR},
      nghe_nghiep = #{row.ngheNghiep,jdbcType=NVARCHAR},
      dia_chi = #{row.diaChi,jdbcType=NVARCHAR},
      ngay_dang_ky = #{row.ngayDangKy,jdbcType=NVARCHAR},
      trang_thai_tiem = #{row.trangThaiTiem,jdbcType=INTEGER}
    <if test="example != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="exam.entities.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    update Person
    <set>
      <if test="hoTen != null">
        ho_ten = #{hoTen,jdbcType=NVARCHAR},
      </if>
      <if test="ngaySinh != null">
        ngay_sinh = #{ngaySinh,jdbcType=VARCHAR},
      </if>
      <if test="gioiTinh != null">
        gioi_tinh = #{gioiTinh,jdbcType=VARCHAR},
      </if>
      <if test="soDienThoai != null">
        so_dien_thoai = #{soDienThoai,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="soTheBhyt != null">
        so_the_BHYT = #{soTheBhyt,jdbcType=VARCHAR},
      </if>
      <if test="ngheNghiep != null">
        nghe_nghiep = #{ngheNghiep,jdbcType=NVARCHAR},
      </if>
      <if test="diaChi != null">
        dia_chi = #{diaChi,jdbcType=NVARCHAR},
      </if>
      <if test="ngayDangKy != null">
        ngay_dang_ky = #{ngayDangKy,jdbcType=NVARCHAR},
      </if>
      <if test="trangThaiTiem != null">
        trang_thai_tiem = #{trangThaiTiem,jdbcType=INTEGER},
      </if>
    </set>
    where CCCD = #{cccd,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="exam.entities.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 12 13:50:13 ICT 2024.
    -->
    update Person
    set ho_ten = #{hoTen,jdbcType=NVARCHAR},
      ngay_sinh = #{ngaySinh,jdbcType=VARCHAR},
      gioi_tinh = #{gioiTinh,jdbcType=VARCHAR},
      so_dien_thoai = #{soDienThoai,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      so_the_BHYT = #{soTheBhyt,jdbcType=VARCHAR},
      nghe_nghiep = #{ngheNghiep,jdbcType=NVARCHAR},
      dia_chi = #{diaChi,jdbcType=NVARCHAR},
      ngay_dang_ky = #{ngayDangKy,jdbcType=NVARCHAR},
      trang_thai_tiem = #{trangThaiTiem,jdbcType=INTEGER}
    where CCCD = #{cccd,jdbcType=VARCHAR}
  </update>

  <select id="findAllMapDTO" resultMap="subDTO">
      select p.CCCD,
             p.ho_ten,
             p.ngay_sinh,
             p.gioi_tinh,
             p.so_dien_thoai,
             p.email,
             p.so_the_BHYT,
             p.nghe_nghiep,
             p.dia_chi,
             p.ngay_dang_ky,
             p.trang_thai_tiem,
             count(tc.CCCD) as so_lan_tiem,
             Max(tc.ngay_tiem) as ngay_tiem_gan_nhat
      from Person p
             left join TiemChung tc
                    on p.CCCD = tc.CCCD
      group by p.CCCD, p.ho_ten, p.ngay_sinh, p.gioi_tinh, p.so_dien_thoai, p.email, p.so_the_BHYT, p.nghe_nghiep,
               p.dia_chi, p.ngay_dang_ky, p.trang_thai_tiem;
  </select>

  <select id="search" parameterType="java.lang.String" resultMap="subDTO">
    select p.CCCD,
           p.ho_ten,
           p.ngay_sinh,
           p.gioi_tinh,
           p.so_dien_thoai,
           p.email,
           p.so_the_BHYT,
           p.nghe_nghiep,
           p.dia_chi,
           p.ngay_dang_ky,
           p.trang_thai_tiem,
           count(tc.CCCD) as so_lan_tiem,
           Max(tc.ngay_tiem) as ngay_tiem_gan_nhat
    from Person p
           left join TiemChung tc
                on p.CCCD = tc.CCCD
    where p.ho_ten like #{searchName}
    group by p.CCCD, p.ho_ten, p.ngay_sinh, p.gioi_tinh, p.so_dien_thoai, p.email, p.so_the_BHYT, p.nghe_nghiep,
             p.dia_chi, p.ngay_dang_ky, p.trang_thai_tiem
    having count(tc.CCCD) like #{count};
  </select>


  <update id="modify" parameterType="map">
    update Person
    set trang_thai_tiem = #{status,jdbcType=INTEGER}
    where CCCD = #{id,jdbcType=VARCHAR}
  </update>

</mapper>